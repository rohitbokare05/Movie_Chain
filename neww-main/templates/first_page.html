<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="initial-scale=1, width=device-width" />
        <meta
            name="description"
            content="MovieChain - Connect with MetaMask to manage movie shows"
        />
        <meta name="author" content="Your Name" />
        <title>MovieChain - Connect MetaMask</title>
        <link rel="stylesheet" href="./global.css" />
        <link rel="stylesheet" href="./connect-ddd.css" />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Abhaya+Libre:wght@700&display=swap"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Irish+Grover:wght@400&display=swap"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Laila:wght@700&display=swap"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Inspiration:wght@400&display=swap"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Itim:wght@400&display=swap"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Love+Ya+Like+A+Sister:wght@400&display=swap"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Italiana:wght@400&display=swap"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Inter:wght@600&display=swap"
        />
        {% comment %}
        <script src="../static/app.js" defer></script>
        {% endcomment %}
    </head>
    <body>
        <div class="connect-ddd">
            <div class="login2">
                <div class="login-inner"></div>
                <button class="vector-container" aria-label="Add Movie Show">
                    <div><a href="create_event/">Add Movie Show</a></div>
                </button>
                <button
                    class="vector-container"
                    aria-label="Ongoing Movie Shows"
                >
                    <div><a href="ongoing_events/">Ongoing Movie Shows</a></div>
                </button>
            </div>
        </div>
        <div>
            <button id="connectButton" aria-label="Connect MetaMask">
                Connect MetaMask
            </button>
        </div>
        <h1 class="moviechain1">MovieChain</h1>
        <!-- <!-- <script>
            document.addEventListener("DOMContentLoaded", () => {
                const connectButton = document.getElementById("connectButton");

                connectButton.addEventListener("click", async () => {
                    if (window.ethereum) {
                        try {
                            const accounts = await window.ethereum.request({
                                method: "eth_requestAccounts",
                            });
                            const account = accounts[0];

                            const message =
                                "Please sign this message to authenticate: " +
                                new Date().toISOString();
                            const signature = await window.ethereum.request({
                                method: "personal_sign",
                                params: [message, account],
                            });

                            const response = await fetch("/authenticate/", {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                },
                                body: JSON.stringify({
                                    address: account,
                                    signature: signature,
                                    message: message,
                                }),
                            });

                            const result = await response.json();
                            if (result.status === "success") {
                                console.log("Authenticated:", result.address);
                            } else {
                                console.error(
                                    "Authentication failed:",
                                    result.message
                                );
                            }
                        } catch (error) {
                            console.error("Error:", error);
                        }
                    } else {
                        console.error("MetaMask not installed");
                    }
                });
            });
        </script> -->

        <!-- <script>
                // Function to get the CSRF token from cookies
                function getCookie(name) {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                } -->

        <!-- const csrftoken = getCookie('csrftoken');

                // Add CSRF token to fetch headers
                async function authenticateWithMetaMask() {
                    if (window.ethereum) {
                        try {
                            const accounts = await window.ethereum.request({
                                method: "eth_requestAccounts",
                            });
                            const account = accounts[0];

                            const message = "Please sign this message to authenticate: " + new Date().toISOString();
                            const signature = await window.ethereum.request({
                                method: "personal_sign",
                                params: [message, account],
                            });

                            const response = await fetch("/authenticate/", {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                    "X-CSRFToken": csrftoken, // Include CSRF token here
                                },
                                body: JSON.stringify({
                                    address: account,
                                    signature: signature,
                                    message: message,
                                }),
                            });

                            const result = await response.json();
                            if (result.status === "success") {
                                console.log("Authenticated:", result.address);
                            } else {
                                console.error("Authentication failed:", result.message);
                            }
                        } catch (error) {
                            console.error("Error:", error);
                        }
                    } else {
                        console.error("MetaMask not installed");
                    }
                }

                document.addEventListener("DOMContentLoaded", () => {
                    const connectButton = document.getElementById("connectButton");
                    connectButton.addEventListener("click", authenticateWithMetaMask);
                });
            </>
            <!-- function getCookie(name) {
                 let cookieValue = null;
                 if (document.cookie && document.cookie !== "") {
                     const cookies = document.cookie.split(";");
                     for (let i = 0; i < cookies.length; i++) {
                         const cookie = cookies[i].trim();
                         if (
                             cookie.substring(0, name.length + 1) ===
                             name + "="
                         ) {
                             cookieValue = decodeURIComponent(
                                 cookie.substring(name.length + 1)
                             );
                             break;
                         }
                     }
                 }
                 return cookieValue;
             } -->
        <!-- 
             const csrftoken = getCookie("csrftoken");
        </script> -->
    </body>
</html>
